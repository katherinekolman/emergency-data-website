<!DOCTYPE html>
<html lang="en">

<!-- To do:
 * change vars to lets?
 * fix quotes
 * organize variables
 * set bounds to san francisco area
 * FIXME
 * optimizations
 * comment code
 * give credit to outside resources (Chart.js, etc)
 * parseFloat instead of parseInt
 * fix image locations
 -->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>San Francisco Emergency Trends</title>


    <link rel="stylesheet" href="main.css" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">

    <script src="jquery.js"></script>
    <script src="Chart.js"></script>
    <script src="markerclusterer.js"></script>
    <script src="getCategoryData.js"></script>
    <script src="mostLikelyDispatch.js"></script>
    <script src="sortByZipcode.js"></script>
</head>

<body>
    <div id="container">
        <div id="background_border">
            <div id="banner">
                <h1 id="page_title">San Francisco Emergency Response Statistics</h1>
            </div>




            <div id="nav_bar">
                <ul>
                    <li id="incident_info">Incident Information</li>
                    <li id="interesting_metrics">Interesting Metrics</li>
                    <li id="avg_dispatch_data">Average Dispatch Data</li>
                </ul>
            </div>
            <script>
                $("#incident_info").click(function() {
                    $('html, body').animate({
                        scrollTop: $("#incident_time_chart").offset().top
                    }, 1500);
                });
            </script>

            <p id="page_description">This webpage provides some trends found in data provided by<br /> the San Francisco Fire Department.</p>

            <div id="tabset_1">
                <!-- for the whole first tabbed section -->
                <!--FIXME include charts -->
                <div id="map_border">
                    <div id="map"></div>

                    <script>
                    function showTab(e, element) {
                        var tab_content = document.getElementsByClassName("tab_content");

                        for (let i = 0; i < tab_content.length; i++) {
                            tab_content[i].style.display = "none";
                        }

                        var tab_buttons = document.getElementsByClassName("tab_button");
                        for (let i = 0; i < tab_buttons.length; i++) {
                            tab_buttons[i].className = tab_buttons[i].className.replace(" active", "");
                        }

                        document.getElementById(element).style.display = "block";
                        e.currentTarget.className += " active";

                    }
                    </script>


                    <div class="tabs" id="tab_bar_1">
                        <button class="tab_button" id="tab_1_button_1">Incident Locations</button>
                        <script>document.getElementById("tab_1_button_1").addEventListener("click", function(event){showTab(event, "incident_locations")});</script>
                        <button class="tab_button" id="tab_1_button_2">Emergency Prediction</button>
                        <script>document.getElementById("tab_1_button_2").addEventListener("click", function(event){showTab(event, "emergency_prediction")});</script>
                    </div>



                    <div class="tab_content" id="incident_locations">


                        <script>
                            // This function toggles the markers on the map.
                            function showMarkers(type, index, id) {
                                if (document.getElementById(id).checked) {
                                    mapData(type, index);
                                } else {
                                    markerCluster[index].clearMarkers();
                                }

                            }
                        </script>

                        <!-- Checkboxes for the left side of the panel -->
                        <div id="checkbox_row_1">

                            <input type="checkbox" id="checkbox_1" class="checkbox" autocomplete="off"><label for="checkbox_1"></label>
                            <script>
                                document.getElementById("checkbox_1").addEventListener("click", function() {
                                    showMarkers("alarm", 0, "checkbox_1");
                                });
                            </script>
                            <br />

                            <input type="checkbox" id="checkbox_2" class="checkbox" autocomplete="off"><label for="checkbox_2"></label>
                            <script>
                                document.getElementById("checkbox_2").addEventListener("click", function() {
                                    showMarkers("citizen", 1, "checkbox_2");
                                });
                            </script>
                            <br />

                            <input type="checkbox" id="checkbox_3" class="checkbox" autocomplete="off"><label for="checkbox_3"></label>
                            <script>
                                document.getElementById("checkbox_3").addEventListener("click", function() {
                                    showMarkers("elehaz", 2, "checkbox_3");
                                });
                            </script>
                            <br />

                            <input type="checkbox" id="checkbox_4" class="checkbox" autocomplete="off"><label for="checkbox_4"></label>
                            <script>
                                document.getElementById("checkbox_4").addEventListener("click", function() {
                                    showMarkers("elerescue", 3, "checkbox_4");
                                });
                            </script>
                            <br />

                            <input type="checkbox" id="checkbox_5" class="checkbox" autocomplete="off"><label for="checkbox_5"></label>
                            <script>
                                document.getElementById("checkbox_5").addEventListener("click", function() {
                                    showMarkers("fuel", 4, "checkbox_5");
                                });
                            </script>

                        </div>

                        <div id="checkbox_row_1_label">
                            <span>Alarm</span><br />
                            <span>Citizen Assist / Service Call</span><br />
                            <span>Electrical Hazard</span><br />
                            <span>Elevator Rescue</span><br />
                            <span>Fuel Spill</span><br />
                        </div>

                        <div id="checkbox_row_2">

                            <input type="checkbox" id="checkbox_6" class="checkbox" autocomplete="off"><label for="checkbox_6"></label>
                            <script>
                                document.getElementById("checkbox_6").addEventListener("click", function() {
                                    showMarkers("gas", 5, "checkbox_6");
                                });
                            </script>
                            <br />

                            <input type="checkbox" id="checkbox_7" class="checkbox" autocomplete="off"><label for="checkbox_7"></label>
                            <script>
                                document.getElementById("checkbox_7").addEventListener("click", function() {
                                    showMarkers("hazmat", 6, "checkbox_7");
                                });
                            </script>
                            <br />

                            <input type="checkbox" id="checkbox_8" class="checkbox" autocomplete="off"><label for="checkbox_8"></label>
                            <script>
                                document.getElementById("checkbox_8").addEventListener("click", function() {
                                    showMarkers("medinc", 7, "checkbox_8");
                                });
                            </script>
                            <br />

                            <input type="checkbox" id="checkbox_9" class="checkbox" autocomplete="off"><label for="checkbox_9"></label>
                            <script>
                                document.getElementById("checkbox_9").addEventListener("click", function() {
                                    showMarkers("odor", 8, "checkbox_9");
                                });
                            </script>
                            <br />

                            <input type="checkbox" id="checkbox_10" class="checkbox" autocomplete="off"><label for="checkbox_10"></label><br />
                            <script>
                                document.getElementById("checkbox_10").addEventListener("click", function() {
                                    showMarkers("other", 9, "checkbox_10");
                                });
                            </script>
                        </div>

                        <div id="checkbox_row_2_label">
                            <span>Gas Leak (Natural and LP Gases)</span><br />
                            <span>HazMat</span><br />
                            <span>Medical Incident</span><br />
                            <span>Odor (Strange / Unknown)</span><br />
                            <span>Other</span><br />
                        </div>

                        <div id="checkbox_row_3">
                            <input type="checkbox" id="checkbox_11" class="checkbox" autocomplete="off"><label for="checkbox_11"></label>
                            <script>
                                document.getElementById("checkbox_11").addEventListener("click", function() {
                                    showMarkers("outfire", 10, "checkbox_11");
                                });
                            </script>
                            <br />

                            <input type="checkbox" id="checkbox_12" class="checkbox" autocomplete="off"><label for="checkbox_12"></label>
                            <script>
                                document.getElementById("checkbox_12").addEventListener("click", function() {
                                    showMarkers("smoke", 11, "checkbox_12");
                                });
                            </script>
                            <br />

                            <input type="checkbox" id="checkbox_13" class="checkbox" autocomplete="off"><label for="checkbox_13"></label>
                            <script>
                                document.getElementById("checkbox_13").addEventListener("click", function() {
                                    showMarkers("structfire", 12, "checkbox_13");
                                });
                            </script>
                            <br />

                            <input type="checkbox" id="checkbox_14" class="checkbox" autocomplete="off"><label for="checkbox_14"></label>
                            <script>
                                document.getElementById("checkbox_14").addEventListener("click", function() {
                                    showMarkers("traffic", 13, "checkbox_14");
                                });
                            </script>
                            <br />

                            <input type="checkbox" id="checkbox_15" class="checkbox" autocomplete="off"><label for="checkbox_15"></label>
                            <script>
                                document.getElementById("checkbox_15").addEventListener("click", function() {
                                    showMarkers("train", 14, "checkbox_15");
                                });
                            </script>
                        </div>

                        <div id="checkbox_row_3_label">
                            <span>Outside Fire</span><br />
                            <span>Smoke Investigation (Outside)</span><br />
                            <span>Structure Fire</span><br />
                            <span>Traffic Collision</span><br />
                            <span>Train / Rail Incident</span><br />
                        </div>

                        <div id="checkbox_row_4">
                            <input type="checkbox" id="checkbox_16" class="checkbox" autocomplete="off"><label for="checkbox_16"></label>
                            <script>
                                document.getElementById("checkbox_16").addEventListener("click", function() {
                                    showMarkers("vehicle", 15, "checkbox_16");
                                });
                            </script>
                            <br />

                            <input type="checkbox" id="checkbox_17" class="checkbox" autocomplete="off"><label for="checkbox_17"></label>
                            <script>
                                document.getElementById("checkbox_17").addEventListener("click", function() {
                                    showMarkers("water", 16, "checkbox_17");
                                });
                            </script>
                        </div>

                        <div id="checkbox_row_4_label">
                            <span>Vehicle Fire</span><br />
                            <span>Water Rescue</span><br />
                        </div>
                    </div>

                    <div class="tab_content" id="emergency_prediction">
                        <div id="prediction_description">
                        <p>Given a time and address, this predicts the most likely emergency that had occurred.
                            <br />This also gives the dispatch most sent to that area during that time.</p>
                        </div>

                            <div id="most_likely_dispatch">
                                Address <input type="text" id="address_input"> <br />
                                Time: (Please use the format 00:00 AM) <input type="text" id="time_input"> <br />
                                <button id="get_dispatch_button">Predict Dispatch and Emergency</button>
                                <script></script>
                            </div>

                    </div>


                </div>
            </div>










            <div id="content">

                <canvas id="call_type_chart" width="400" height="250" style="display: block; width = 100px; height = 50px;"></canvas>
                <canvas id="incident_time_chart" width="400" height="350" style="display: block; width = 700px; height = 350px;"></canvas>
                <canvas id="resolution_time_chart" width="400" height="350" style="display: block; width = 700px; height = 350px;"></canvas>
                <canvas id="avg_dispatch_chart" width="400" height="350" style="display: block; width = 700px; height = 350px;"></canvas>


                <div id="call_type_data">
                    <button id="alarm_button">Alarm data</button>
                    <button id="citizen_button">citizen data</button>
                    <button id="ele_haz_button">ele haz data</button>
                    <button id="ele_rescue_button">ele rescue data</button>
                    <button id="fuel_button">fuel data</button>
                    <button id="gas_button">gas data</button>
                    <button id="hazmat_button">hazmat data</button>
                    <button id="med_inc_button">med_inc data</button>
                    <button id="odor_button">odor data</button>
                    <button id="other_button">other data</button>
                    <button id="out_fire_button">out_fire data</button>
                    <button id="smoke_button">smoke data</button>
                    <button id="struct_fire_button">struct fire data</button>
                    <button id="traffic_button">traffic data</button>
                    <button id="train_button">train data</button>
                    <button id="vehicle_button">vehicle data</button>
                    <button id="water_button">water data</button>
                    <button id="resolution_button">resolution</button>
                    <button id="avg_dispatch_button">dispatch</button>
                    <button id="heatmap_data">heatmap</button>
                    <button id="init_button">init</button>
                    <button id="dipatch">yeah</button>
                </div>
            </div>
            <p id="footer">Created by Katherine Kolman</p>

        </div>
        <div id="bottom_image">
            <img src="images/goldengatebridge2.jpg" />
        </div>
    </div>



    <!-- FIXME add a banner at bottom, link github page -->


    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA0cYEpHgp2dpM4w6ZMp8nlMHX5i1fA2xg&libraries=visualization&callback=initialize"></script>

    <script>
        document.getElementById("get_dispatch_button").addEventListener("click", findAddress);
        document.getElementById("dipatch").addEventListener("click", function() {
            updateChart(avgDispatchChart, getAvgDispatchTime());
        });

        //FIXME reformat this
        document.getElementById("resolution_button").addEventListener("click", function() {
            updateChart(resolutionTimeChart, getResolutionTime());
        });

        document.getElementById("avg_dispatch_button").addEventListener("click", getHeatmapData);

        document.getElementById("alarm_button").addEventListener("click", function() {
            mapData("alarm");
            updateChart(incidentTimeChart, getIncidentTimeData("alarm"));
        });
        document.getElementById("citizen_button").addEventListener("click", function() {
            mapData("citizen");
            updateChart(incidentTimeChart, getIncidentTimeData("citizen"));
        });
        document.getElementById("ele_haz_button").addEventListener("click", function() {
            mapData("elehaz");
            updateChart(incidentTimeChart, getIncidentTimeData("elehaz"));
        });
        document.getElementById("ele_rescue_button").addEventListener("click", function() {
            mapData("elerescue");
            updateChart(incidentTimeChart, getIncidentTimeData("elerescue"));
        });
        document.getElementById("fuel_button").addEventListener("click", function() {
            mapData("fuel");
            updateChart(incidentTimeChart, getIncidentTimeData("fuel"));
        });
        document.getElementById("gas_button").addEventListener("click", function() {
            mapData("gas");
            updateChart(incidentTimeChart, getIncidentTimeData("gas"));
        });
        document.getElementById("hazmat_button").addEventListener("click", function() {
            mapData("hazmat");
            updateChart(incidentTimeChart, getIncidentTimeData("hazmat"));
        });
        document.getElementById("med_inc_button").addEventListener("click", function() {
            mapData("medinc");
            updateChart(incidentTimeChart, getIncidentTimeData("medinc"));
        });
        document.getElementById("odor_button").addEventListener("click", function() {
            mapData("odor");
            updateChart(incidentTimeChart, getIncidentTimeData("odor"));
        });
        document.getElementById("other_button").addEventListener("click", function() {
            mapData("other");
            updateChart(incidentTimeChart, getIncidentTimeData("other"));
        });
        document.getElementById("out_fire_button").addEventListener("click", function() {
            mapData("outfire");
            updateChart(incidentTimeChart, getIncidentTimeData("outfire"));
        });
        document.getElementById("smoke_button").addEventListener("click", function() {
            mapData("smoke");
            updateChart(incidentTimeChart, getIncidentTimeData("smoke"));
        });
        document.getElementById("struct_fire_button").addEventListener("click", function() {
            mapData("structfire");
            updateChart(incidentTimeChart, getIncidentTimeData("structfire"));
        });
        document.getElementById("traffic_button").addEventListener("click", function() {
            mapData("traffic");
            updateChart(incidentTimeChart, getIncidentTimeData("traffic"));
        });
        document.getElementById("train_button").addEventListener("click", function() {
            mapData("train");
            updateChart(incidentTimeChart, getIncidentTimeData("train"));
        });
        document.getElementById("vehicle_button").addEventListener("click", function() {
            mapData("vehicle");
            updateChart(incidentTimeChart, getIncidentTimeData("vehicle"));
        });
        document.getElementById("water_button").addEventListener("click", function() {
            mapData("water");
            updateChart(incidentTimeChart, getIncidentTimeData("water"));
        })

        //    $(document).ready(function() {
        $.ajax({
            type: "GET",
            url: "sfpd_data.csv",
            dataType: "text",
            success: function(data) {
                parseCSV(data);
            }
        });
        //    });

        /* This function goes through the data from the given CSV file
         *  and puts it in a multidimensional array.
         */
        var csvData = [];

        //FIXME move this to a better location
        var callTypes = ['Alarms', 'Citizen Assist / Service Call', 'Electrical Hazard', 'Elevator / Escalator Rescue', 'Fuel Spill',
            'Gas Leak (Natural and LP Gases)', 'HazMat', 'Medical Incident', 'Odor (Strange / Unknown)', 'Other',
            'Outside Fire', 'Smoke Investigation (Outside)', 'Structure Fire', 'Traffic Collision', 'Train / Rail Incident',
            'Vehicle Fire', 'Water Rescue'
        ];

        function parseCSV(data) {
            var allLines = data.split(/\n|\n\r/);
            csvData = [];

            // loop through all the lines to sort data into single incidents
            for (var i = 1; i < allLines.length; i++) {
                var line = allLines[i].split(",");
                csvData.push(line);
            }
        }

        // google maps variables
        var geocoder;
        var markerMap;
        var geocodeMap;
        var dispatchTimeHeatmap;
        var heatmap;
        var markerCluster = [];
        var locations = [];
        var markers = [];

        /* This function initializes all the maps on the page from the google maps API,
         * including the geocoding map and the general map of San Francisco.
         */
        function initialize() {
            geocoder = new google.maps.Geocoder();
            var options = {
                center: new google.maps.LatLng(37.7749, -122.4194),
                zoom: 12,
                mapTypeId: google.maps.MapTypeId.ROADMAP // change the style and colors of map to fit theme of site
            };
            //    geocodeMap = new google.maps.Map(document.getElementById("map"), options);
            markerMap = new google.maps.Map(document.getElementById("map"), options);
            //    dispatchTimeHeatmap = new google.maps.Map(document.getElementById("map"), options);

            //    var heatData = getHeatmapData();

            // heatmap = new google.maps.visualization.HeatmapLayer();
            //
            //
            // heatmap.set('opacity', .3);
            // heatmap.set('dissipating', true);
            // heatmap.set('maxIntensity', 10);
            //
            // heatmap.setData(heatData);
            // heatmap.setMap(dispatchTimeHeatmap);
            // //console.log(heatmap.getData());

            for (var i = 0; i < 18; i++) {
                markerCluster[i] = new MarkerClusterer(markerMap, markers, {
                    imagePath: "./images/m"
                });
            }
        }

        /* This function places markers at the location of the incidents
         * on a map.
         */
        function mapData(type, index) {
            locations = [];
            markers = [];
            data = [];
            markerCluster[index].clearMarkers();

            data = getCategoryData(csvData, type);

            for (var i = 0; i < data.length; i++) {
                locations.push(new google.maps.LatLng(data[i][0], data[i][1]));
            }

            var markers = locations.map(function(location, i) {
                return new google.maps.Marker({
                    position: location,
                });
            });

            markerCluster[index] = new MarkerClusterer(markerMap, markers, {
                imagePath: "./images/m"
            });
        }

        function updateChart(chart, typeData) {
            chart.data.datasets[0].data = typeData;
            chart.update();
        }

        // the chart containing the number of all of the different types of incidents

        new Chart(document.getElementById("call_type_chart"), {
            type: 'doughnut',
            data: {
                datasets: [{
                    data: [1061, 114, 21, 23, 10, 86, 3, 6791, 10, 129, 144, 15, 1029, 410, 55, 45, 54]
                }],

                labels: ['Alarms', 'Citizen Assist / Service Call', 'Electrical Hazard', 'Elevator / Escalator Rescue', 'Fuel Spill',
                    'Gas Leak (Natural and LP Gases)', 'HazMat', 'Medical Incident', 'Odor (Strange / Unknown)', 'Other',
                    'Outside Fire', 'Smoke Investigation (Outside)', 'Structure Fire', 'Traffic Collision', 'Train / Rail Incident',
                    'Vehicle Fire', 'Water Rescue'
                ]
            },
            options: {
                responsive: false
            }
        });

        var resolutionTimeChart = new Chart(document.getElementById("resolution_time_chart"), {
            type: 'bar',
            data: {
                datasets: [{ //FIXME call updateChart on page load to update this data
                    data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
                }],

                labels: ['Alarms', 'Citizen Assist / Service Call', 'Electrical Hazard', 'Elevator / Escalator Rescue', 'Fuel Spill',
                    'Gas Leak (Natural and LP Gases)', 'HazMat', 'Medical Incident', 'Odor (Strange / Unknown)', 'Other',
                    'Outside Fire', 'Smoke Investigation (Outside)', 'Structure Fire', 'Traffic Collision', 'Train / Rail Incident',
                    'Vehicle Fire', 'Water Rescue'
                ]
            },
            options: {
                responsive: false,
                scaleShowValues: true,
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }],
                    xAxes: [{
                        ticks: {
                            autoSkip: false
                        }
                    }]
                }
            }
        });

        var incidentTimeChart = new Chart(document.getElementById("incident_time_chart"), {
            type: 'line',
            data: {
                datasets: [{
                    data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    label: "Number of Occurences"
                }],
                labels: ['12 AM', '1 AM', '2 AM', '3 AM', '4 AM', '5 AM', '6 AM', '7 AM', '8 AM', '9 AM', '10 AM', '11 AM',
                    '12 PM', '1 PM', '2 PM', '3 PM', '4 PM', '5 PM', '6 PM', '7 PM', '8 PM', '9 PM', '10 PM', '11 PM'
                ]
            },
            options: {
                responsive: false
            }
        });

        var avgDispatchChart = new Chart(document.getElementById("avg_dispatch_chart"), {
            type: 'bar',
            data: {
                datasets: [{
                    data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    label: "Average Dispatch Time"
                }],
                labels: ['94102', '94103', '94104', '94105', '94107', '94108', '94109', '94110', '94111', '94112', '94114',
                    '94115', '94116', '94117', '94118', '94121', '94123', '94124', '94127', '94129', '94130', '94131',
                    '94132', '94133', '94134', '94158'
                ]
            },
            options: {
                responsive: false
            }
        })

        /* This function gets the number of occurences of a incident type and sorts it
         * by time of day within hour long intervals starting at the half-hour mark (for
         * example, everything between 11:30 PM and 12:30 AM is considered to occur at 12 AM).
         */
        function getIncidentTimeData(type) {
            var data = getCategoryData(csvData, type);
            var time = [];
            var incidentTimes = [];
            var numOccurences = [];

            for (var i = 0; i < data.length; i++) {
                var temp = data[i][2].split(" ");
                temp = temp[1].split(/:| /);
                time.push(temp);
            }

            // initialize to 0
            for (var i = 0; i < 24; i++) {
                numOccurences.push(0);
            }

            console.log(data.length);

            //sorts times into different categories
            for (var i = 0; i < data.length; i++) {
                if (parseInt(time[i][1]) < 30) {
                    numOccurences[parseInt(time[i][0])] += 1;
                } else {
                    if (parseInt(time[i][0]) + 1 < 24) {
                        numOccurences[parseInt(time[i][0]) + 1] += 1;
                    } else {
                        numOccurences[0] += 1;
                    }
                }
            }
            return numOccurences;
        }

        /**
         * This function returns the average resolution time for each call type.
         */
        function getResolutionTime() {
            // holds the average resolution type of each element (indices correspond to type)
            var timeData = [];
            var resolutionData = [];
            let temp = [];
            let temp1 = [];

            for (var i = 1; i < csvData.length - 1; i++) {
                temp = [];
                temp1 = [];
                if (csvData[i][5].length > 1 && csvData[i][6].length > 1) {
                    temp.push(csvData[i][0]);
                    temp1.push(csvData[i][5]);
                    temp1.push(csvData[i][6]);
                    temp.push(temp1);
                    timeData.push(temp);
                }
            }

            temp = [];
            for (var i = 0; i < timeData.length; i++) {
                temp.push(calcTimeDiff(timeData[i][1]));
                if (temp[0] > 500) {
                    temp = [];
                    continue;
                }
                timeData[i][1] = temp[0];
                temp = [];
            }

            for (var i = 0; i < 17; i++) {
                resolutionData.push(new Array());
            }

            for (var i = 0; i < timeData.length; i++) {
                for (var j = 0; j < callTypes.length; j++) {
                    if (timeData[i][0] == callTypes[j]) {
                        resolutionData[j].push(timeData[i][1]);
                    }
                }
            }

            for (let i = 0; i < resolutionData.length; i++) {
                resolutionData[i] = average(resolutionData[i]);
            }

            return resolutionData;
        }

        function average(data) {
            var sum = 0;
            for (let i = 0; i < data.length; i++) {
                sum += parseInt(data[i]);
            }
            return Math.round(sum / data.length);
        }


        function calcTimeDiff(data) {
            var hourA = data[0].split(" ")[1].split(/:| /)[0];
            var minuteA = data[0].split(" ")[1].split(/:| /)[1];

            var hourB = data[1].split(" ")[1].split(/:| /)[0];
            var minuteB = data[1].split(" ")[1].split(/:| /)[1];

            if (hourA == hourB) {
                return minuteB - minuteA;
            } else {
                if (hourA > hourB) {
                    hourA -= 12;
                    hourB += 12;
                    if (minuteA < minuteB) {
                        return minuteB - minuteA + (hourB - hourA) * 60;
                    }
                }
                minuteA = 60 - minuteA;
                hourA = hourB - hourA - 1;
                return minuteA + hourA * 60;
            }
        }

        function getAvgDispatchTime() {
            avgDispatch = [];

            let temp = [];
            let temp1 = [];
            for (let i = 0; i < csvData.length - 1; i++) {
                temp = [];
                temp1 = [];
                if (csvData[i][3].length > 0 && csvData[i][5].length > 0 && csvData[i][21].length > 0 &&
                    csvData[i][22].length > 0 && csvData[i][23].length > 0) {
                    temp1.push(csvData[i][3]);
                    temp1.push(csvData[i][5]);
                    temp.push(temp1);
                    temp.push(csvData[i][9]); // zipcodes
                    avgDispatch.push(temp);
                }
            }

            temp = [];
            for (let i = 0; i < avgDispatch.length; i++) {
                temp.push(calcTimeDiff(avgDispatch[i][0]));
                if (temp[0] > 500) {
                    avgDispatch[i][0] = 0;
                    temp = [];
                    continue;
                } else {
                    avgDispatch[i][0] = temp[0];
                    temp = [];
                }
            }

            avgDispatch = sortByZipcode(avgDispatch);

            console.log(avgDispatch);

            return avgDispatch;
        }



        /* This function returns all of the locations of all incidents and weights them according to
         * their dispatch time. Longer dispatch times will have greater weights.
         */
        function getHeatmapData() {
            var heatmapData = [];
            var dataPoints = [];

            let temp = [];
            let temp1 = [];

            loop1:
                for (let i = 0; i < csvData.length - 1; i++) {
                    temp = [];
                    temp1 = [];
                    if (csvData[i][3].length > 0 && csvData[i][5].length > 0 && csvData[i][21].length > 0 &&
                        csvData[i][22].length > 0 && csvData[i][23].length > 0) {

                        // loop2:
                        // for (let j = 0; j < heatmapData.length; j++) {
                        //     if (heatmapData[j][1].includes(csvData[i][22]) && heatmapData[j][2].includes(csvData[i][23])) {
                        //         continue loop1;
                        //     }
                        // }

                        temp1.push(csvData[i][3]);
                        temp1.push(csvData[i][5]);
                        temp.push(temp1);
                        temp.push(csvData[i][22]);
                        temp.push(csvData[i][23]);
                        heatmapData.push(temp);
                    }
                }

            temp = [];
            for (let i = 0; i < heatmapData.length; i++) {
                temp.push(calcTimeDiff(heatmapData[i][0]));
                if (temp[0] > 500) {
                    heatmapData[i][0] = 0;
                    temp = [];
                    continue;
                } else {
                    heatmapData[i][0] = temp[0];
                    temp = [];
                }
            }

            for (var i = 0; i < heatmapData.length; i++) {
                dataPoints.push({
                    location: new google.maps.LatLng(parseFloat(heatmapData[i][1]), parseFloat(heatmapData[i][2])),
                    // the weight is based on the largest dispatch time (64 min), so the ranges of weights will be 1 - 5.
                    weight: (((1 / 16) * parseFloat(heatmapData[i][0])) + 1)
                });
            }
            return (dataPoints);
        }
    </script>
</body>

</html>
